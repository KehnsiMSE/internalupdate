    - name: Check if kernel was updated
      shell: |
        if [ -f /var/run/reboot-required ]; then
          echo "Reboot required"
          exit 0
        else
          echo "No reboot required"
          exit 1
        fi
      register: reboot_required
      changed_when: reboot_required.rc == 0
      failed_when: false

    - name: Reboot the system if required
      reboot:
        msg: "Rebooting due to kernel update"
        connect_timeout: 5
        reboot_timeout: 300
        pre_reboot_delay: 0
        post_reboot_delay: 30
      when: reboot_required.rc == 0
